<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>私は人間？</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css" />
</head>
<body>
  <div id="root"></div>

  <script>
    // 音声ファイルの準備
    const se = new Audio('human.wav');

    // ユーザーが人間であるかを確認する関数
    function verifyHuman() {
      const root = document.getElementById('root');
      root.innerHTML = '';

      // 人間確認済みの画面を表示
      const section = document.createElement('section');
      section.className = 'hero is-primary is-fullheight';

      const heroBody = document.createElement('div');
      heroBody.className = 'hero-body';

      const container = document.createElement('div');
      container.className = 'container has-text-centered';

      const title = document.createElement('p');
      title.className = 'title';
      title.textContent = 'おめでとうございます。あなたは人間です。';

      const subtitle = document.createElement('p');
      subtitle.className = 'subtitle';
      subtitle.textContent = 'ご安心ください。あなたはテストを突破することにより人間だと証明されました。';

      container.appendChild(title);
      container.appendChild(subtitle);
      heroBody.appendChild(container);
      section.appendChild(heroBody);
      root.appendChild(section);

      se.play(); // 音声を再生
    }

    // 初期画面を表示する関数
    function showInitialScreen() {
      const root = document.getElementById('root');
      root.innerHTML = '';

      const section = document.createElement('section');
      section.className = 'hero is-fullheight';

      const heroBody = document.createElement('div');
      heroBody.className = 'hero-body';

      const container = document.createElement('div');
      container.className = 'container has-text-centered';

      const title = document.createElement('p');
      title.className = 'title';
      title.textContent = '自分はロボットではないかと不安な方へ';

      const subtitle = document.createElement('p');
      subtitle.className = 'subtitle';
      subtitle.textContent = '下のチェックボックスをクリックして確かめてみましょう。';

      const box = document.createElement('div');
      box.style.margin = '20px auto';
      box.style.textAlign = 'center';
      box.style.width = '300px';

      const recaptchaDiv = document.createElement('div');
      recaptchaDiv.id = 'html_element';

      box.appendChild(recaptchaDiv);
      container.appendChild(title);
      container.appendChild(subtitle);
      container.appendChild(box);
      heroBody.appendChild(container);
      section.appendChild(heroBody);
      root.appendChild(section);

      // reCAPTCHAをレンダリング
      grecaptcha.render('html_element', {
        sitekey: '6LeJOKcqAAAAACH3ZwCxLl4z23Dyw7-UQFZ9plEn',
        callback: verifyHuman
      });
    }

    // ページの読み込み時に初期画面を表示
    window.onload = showInitialScreen;
  </script>

  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <!-- アクセス条件 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZ6NQ9gR_5r5LX_lnuV3AAahpJrrBZwzg",
      authDomain: "pest-a69d4.firebaseapp.com",
      projectId: "pest-a69d4",
      storageBucket: "pest-a69d4.appspot.com",
      messagingSenderId: "1073634294855",
      appId: "1:1073634294855:web:c2fdf25327abc64ded0562",
      measurementId: "G-WZS7H4KZ83"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // ログイン状態を監視
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "https://pest-religion.github.io/HP/login.html";
      }
    });

    // ログインから48時間以上経過していたら、ログインページにリダイレクト
    window.onload = () => {
      const lastLoginTime = localStorage.getItem('lastLoginTime');
      const currentTime = Date.now();
      if (!lastLoginTime || (currentTime - lastLoginTime >= 48 * 60 * 60 * 1000)) {
        window.location.href = "https://pest-religion.github.io/HP/login.html";
      }
    };
  </script>
</body>
</html>
